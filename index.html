<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>论坛主页</title>
  <link rel="stylesheet" href="css/style.css" type="text/css" />
  <style>
    .menu_2 li {

      color: #fff;

    }
  </style>
</head>

<body>
  <div class="idx">
    <div class="index_headr">
      <nav class="menu">
        <ul class="menu_1">
          <li>
            <div><a href="#"><span id="Username"></span></a></div>
            <ul class="menu_2">
              <li><a>个人首页</a></li>
              <li><a id="personinf">更改信息</a></li>
              <li><a class="quit" href="#">退出</a></li>
            </ul>
          </li>
          <li>
            <div><a href="#">搜索</a></div>
          </li>
          <li>
            <div><a id="conlumns" href="#">社区任务</a></div>
          </li>
          <li>
            <div><a class="quit" href="#">退出</a></div>
          </li>
          <li>
            <div><a id="homeBtn" href="#">主页</a></div>
          </li>
        </ul>
      </nav>
    </div>
    <iframe id="iframebody" src="columns.html" frameborder="0"
      style="width: 100%; height: calc(100vh - 150px);"></iframe>
    <div class="index_footr">3</div>
  </div>

  <script>
    // 页面加载后执行的操作
    document.addEventListener("DOMContentLoaded", function () {
      // 获取存储的用户信息
      const usrData = JSON.parse(localStorage.getItem('usrData')) || [];

      // 查找 logSta 值为 1 的用户
      const loggedInUser = usrData.find(user => user.logSta === 1);

      // 获取所有类为 quit 的链接
      const quitLinks = document.querySelectorAll('.quit');

      // 获取用户名显示的标签
      const usernmtx = document.getElementById('Username');

      // 根据登录状态设置页面显示
      if (loggedInUser) {
        // 用户已登录，更新用户名显示
        usernmtx.innerText = loggedInUser.username;

        // 遍历所有 quit 类的链接，设置退出操作
        quitLinks.forEach(link => {
          link.textContent = '退出';
          link.addEventListener('click', function () {
            // 将所有用户的 logSta 值设为 0
            usrData.forEach(user => {
              user.logSta = 0;
            });

            // 保存更新后的用户信息到 localStorage
            localStorage.setItem('usrData', JSON.stringify(usrData));

            // 返回登录页面
            window.location.href = 'login.html';
          });
        });
      } else {
        // 用户未登录，设置页面显示为未登录状态
        usernmtx.innerText = '未登录';

        // 遍历所有 quit 类的链接，设置登录操作
        quitLinks.forEach(link => {
          link.textContent = '登录';
          link.addEventListener('click', function () {
            // 返回登录页面
            window.location.href = 'login.html';
          });
        });
      }
      const iframebody = document.getElementById('iframebody');
      const conlumns = document.getElementById('conlumns');
      const personinf = document.getElementById('personinf');
    });
    // 监听“更改信息”点击事件
    personinf.addEventListener('click', function (event) {
      event.preventDefault();
      iframebody.src = 'personInf.html';
    });

    // 监听“社区任务”点击事件
    conlumns.addEventListener('click', function (event) {
      event.preventDefault();
      iframebody.src = 'integral.html';
    });
    const homeBtn = document.getElementById('homeBtn');
    homeBtn.addEventListener('click', function (event) {
      event.preventDefault();
      // 设置 iframe 的 src 属性返回主页
      iframebody.src = 'columns.html';
    });
  </script>
</body>

</html>